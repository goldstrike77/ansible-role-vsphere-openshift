---
- name: Create Kubernetes API A records.
  community.windows.win_dns_record:
    name: "{{ item }}.{{ openshift_cluster }}"
    type: "A"
    value: "{{ openshift_network.apivips }}"
    zone: "{{ openshift_dns.forward_zone }}"
  loop:
    - "api"
    - "api-int"
    - "*.apps"

- name: Create Kubernetes API PTR records.
  community.windows.win_dns_record:
    name: '{{ openshift_network.apivips.split(".")[1:4] | reverse | join(".") }}'
    type: "PTR"
    value:
      [
        "api.{{ openshift_cluster }}.{{ openshift_domain }}",
        "api-int.{{ openshift_cluster }}.{{ openshift_domain }}",
        "*.apps.{{ openshift_cluster }}.{{ openshift_domain }}",
      ]
    zone: "{{ openshift_dns.reverse_zone }}"

- name: Create compute machines A records.
  community.windows.win_dns_record:
    name: "{{ item.name }}.{{ openshift_cluster }}"
    type: "A"
    value: "{{ item.ip }}"
    zone: "{{ openshift_dns.forward_zone }}"
  loop: "{{ openshift_node.hosts }}"
  when: openshift_node.hosts is defined

- name: Create compute machines PTR records.
  community.windows.win_dns_record:
    name: '{{ item.ip.split(".")[1:4] | reverse | join(".") }}'
    type: "PTR"
    value: "{{ item.name }}.{{ openshift_cluster }}.{{ openshift_domain }}"
    zone: "{{ openshift_dns.reverse_zone }}"
  loop: "{{ openshift_node.hosts }}"
  when: openshift_node.hosts is defined
